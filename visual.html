<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visual | Mila Baumann</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Gilda+Display&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">

  <style>
    :root {
      --bg: rgb(252, 254, 255);
      --darkred: #000000;
      --bigtext: #000000;
      --nav-safe: 160px;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      min-height: 100vh;
      background: var(--bg);
      color: var(--darkred);
      font-family: "Figtree", sans-serif;
      text-transform: uppercase;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    .thumb {
      display: inline-block;
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;
    }

    .thumb img {
      height: 300px;
      width: auto;
      display: block;
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
      transition: transform .18s ease, opacity .18s ease;
      border: none;
      outline: none;
      box-shadow: none;
      background: transparent;
    }

    .thumb:hover img {
      transform: scale(1.02);
      opacity: .95;
    }

    .hero {
      width: 100%;
      padding: .5rem 2rem 0;
      padding-right: var(--nav-safe);
    }

    .title {
      font-family: "Inter", serif;
      margin-top: 15.25rem;
      font-size: clamp(3rem, 9vw, 9rem);
      font-weight: 900;
      text-transform: uppercase;
      line-height: 1;
      margin-bottom: 0rem;
      color: var(--bigtext);
    }

    .jump {
      width: calc(100% - var(--nav-safe));
      margin-left: auto;
      text-align: right;
      padding-right: var(--nav-safe);
    }

    .jump a {
      text-align: right;
      display: inline-block;
      pointer-events: auto;
      font-family: "Inter", sans-serif;
      font-weight: 700;
      text-decoration: none;
      color: var(--darkred);
      font-size: 1.25rem;
      border-bottom: 2px solid rgba(140, 0, 4, .35);
      transition: opacity .2s ease, border-color .2s ease, transform .2s ease;
    }

    .jump a:hover {
      opacity: .75;
      border-color: rgba(140, 0, 4, .35);
      transform: translateY(-1px);
    }

    .gallery {
      max-width: 1300px;
      padding: 0 2rem 3rem;
      padding-right: var(--nav-safe);
      position: relative;
      z-index: 1;
    }

    #gallery-section {
      scroll-margin-top: 16px;
    }

    .carousel-section {
      width: 100%;
      padding: 2rem 0 .25rem;
      position: relative;
      z-index: 1;
      margin-bottom: 20rem;
    }

    .carousel-viewport {
      width: calc(100% - var(--nav-safe));
      overflow: hidden;
    }

    .carousel-track {
      display: flex;
      gap: 12px;
      align-items: center;
      will-change: transform;
    }

    .grid {
      column-count: 4;
      column-gap: 16px;
    }

    @media (max-width: 1100px) {
      .grid {
        column-count: 3;
      }
    }

    @media (max-width: 900px) {
      .grid {
        column-count: 2;
      }
    }

    .gthumb {
      display: block;
      break-inside: avoid;
      margin-bottom: 16px;
      background: transparent;
      border: none;
      padding: 0;
      cursor: pointer;
    }

    .gthumb img {
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
      transition: transform .18s ease;
      user-select: none;
      -webkit-user-drag: none;
      border: none;
      outline: none;
      box-shadow: none;
      background: transparent;
    }

    .gthumb:hover img {
      transform: scale(1.01);
    }

    dialog#lightbox {
      border: none;
      padding: 0;
      background: transparent;
      width: auto;
      height: auto;
      max-width: none;
      max-height: none;
      overflow: visible;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, .7);
    }

    .lb-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    .lb-img {
      max-width: 95vw;
      max-height: 95vh;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    .lb-close {
      position: fixed;
      top: 16px;
      right: 18px;
      z-index: 1001;
      font-size: 34px;
      line-height: 1;
      color: #fff;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0 8px;
      user-select: none;
    }

    .lb-close:focus {
      outline: 2px solid rgba(255, 255, 255, .6);
      outline-offset: 4px;
    }

    /* Mobile styles */
    @media (max-width: 700px) {
      :root {
        --nav-safe: 0px;
      }

      /* Hide carousel on mobile */
      .carousel-section {
        display: none;
      }

      /* Hide "Gallery view" link since we're only showing gallery */
      .jump {
        display: none;
      }

      .hero {
        padding: 5rem 1.5rem 1rem;
        text-align: left;
      }

      .title {
        margin-top: 0;
        font-size: clamp(2.5rem, 12vw, 4rem);
      }

      .gallery {
        padding: 1rem 1rem 2.5rem;
        max-width: 100%;
      }

      .grid {
        column-count: 2;
        column-gap: 10px;
      }

      .gthumb {
        margin-bottom: 10px;
      }
    }

    @media (max-width: 400px) {
      .grid {
        column-count: 1;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .thumb img,
      .gthumb img {
        transition: none;
      }
    }
  </style>
</head>

<body>
  <!-- Hamburger Button (Mobile) -->
  <button class="hamburger" aria-label="Toggle menu" aria-expanded="false">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay"></div>

  <!-- Navigation -->
  <nav class="nav" aria-label="Primary">
    <a class="btn teal" href="aboutme.html">About</a>
    <a class="btn lemon" href="contact.html">Contact</a>

    <div class="dropdown">
      <a class="btn pink dropdownTrigger" href="#" onclick="return false;">
        Portfolio
      </a>

      <div class="dropdownMenu" aria-label="Portfolio">
        <a class="btn red" href="music.html">Music</a>
        <a class="btn blue" href="visual.html">Visual</a>
      </div>
    </div>
  </nav>

  <section class="hero" aria-labelledby="page-title">
    <h1 id="page-title" class="title">Visual</h1>
  </section>

  <div class="jump">
    <a href="#gallery-section" aria-label="Jump to gallery view">Gallery view ↓</a>
  </div>

  <!-- Horizontal carousel (desktop only) -->
  <section class="carousel-section" aria-label="Visual carousel">
    <div class="carousel-viewport" id="carouselViewport">
      <div class="carousel-track" id="carouselTrack" aria-live="off"></div>
    </div>
  </section>

  <main>
    <!-- Full gallery (masonry) -->
    <section id="gallery-section" class="gallery" aria-label="Gallery view">
      <div id="galleryGrid" class="grid"></div>
    </section>
  </main>

  <!-- Lightbox -->
  <dialog id="lightbox" aria-labelledby="lbHeading">
    <button class="lb-close" id="closeBtn" aria-label="Close">×</button>
    <div class="lb-wrap">
      <img id="lbImg" class="lb-img" alt="">
    </div>
    <h2 id="lbHeading" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;">Image viewer</h2>
  </dialog>

  <script>
    const hamburger = document.querySelector('.hamburger');
    const nav = document.querySelector('.nav');
    const overlay = document.querySelector('.mobile-menu-overlay');

    function toggleMenu() {
      const isOpen = hamburger.classList.toggle('active');
      nav.classList.toggle('active');
      overlay.classList.toggle('active');
      hamburger.setAttribute('aria-expanded', isOpen);
      document.body.style.overflow = isOpen ? 'hidden' : '';
    }

    hamburger.addEventListener('click', toggleMenu);
    overlay.addEventListener('click', toggleMenu);

    nav.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        if (nav.classList.contains('active')) {
          toggleMenu();
        }
      });
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && nav.classList.contains('active')) {
        toggleMenu();
      }
    });

    const track = document.getElementById('carouselTrack');
    const viewport = document.getElementById('carouselViewport');
    const gridEl = document.getElementById('galleryGrid');

    const lightbox = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const closeBtn = document.getElementById('closeBtn');

    let items = [];
    let currentIndex = 0;

    // Auto-scroll state
    let pos = 0;
    let speed = 40;
    let lastTs = null;
    let paused = false;

    function friendlyTitle(name) {
      const base = name.replace(/\.[^.]+$/, '');
      return base.replace(/[_-]+/g, ' ').trim();
    }

    function buildCarouselThumb(item, i) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'thumb';
      btn.setAttribute('aria-label', `Open ${item.title}`);
      btn.addEventListener('click', () => openLightbox(i));

      const img = document.createElement('img');
      img.src = item.url;
      img.alt = item.title;
      img.loading = 'lazy';
      img.decoding = 'async';

      btn.appendChild(img);
      return btn;
    }

    function buildGalleryThumb(item, i) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'gthumb';
      btn.setAttribute('aria-label', `Open ${item.title}`);
      btn.addEventListener('click', () => openLightbox(i));

      const img = document.createElement('img');
      img.src = item.url;
      img.alt = item.title;
      img.loading = 'lazy';
      img.decoding = 'async';

      btn.appendChild(img);
      return btn;
    }

    function renderGallery() {
      gridEl.innerHTML = '';
      items.forEach((it, i) => gridEl.appendChild(buildGalleryThumb(it, i)));
    }

    function buildCarousel() {
      track.innerHTML = '';
      items.forEach((it, i) => track.appendChild(buildCarouselThumb(it, i)));
      requestAnimationFrame(() => {
        pos = 0;
      });
    }

    function childOuterWidth(el) {
      const rect = el.getBoundingClientRect();
      return rect.width + 12;
    }

    function tick(ts) {
      if (lastTs == null) lastTs = ts;
      const dt = (ts - lastTs) / 1000;
      lastTs = ts;

      const motionOK = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const isMobile = window.matchMedia('(max-width: 700px)').matches;

      if (motionOK && !paused && !isMobile && track.children.length) {
        pos -= speed * dt;

        let first = track.firstElementChild;
        while (first) {
          const firstWidth = childOuterWidth(first);
          if (-pos >= firstWidth) {
            track.appendChild(first);
            pos += firstWidth;
            first = track.firstElementChild;
          } else {
            break;
          }
        }

        track.style.transform = `translateX(${pos}px)`;
      }

      requestAnimationFrame(tick);
    }

    function openLightbox(index) {
      currentIndex = ((index % items.length) + items.length) % items.length;
      const it = items[currentIndex];
      lbImg.src = it.url;
      lbImg.alt = it.title;
      if (!lightbox.open) lightbox.showModal();
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      if (lightbox.open) lightbox.close();
      lbImg.src = '';
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }

    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
    window.addEventListener('keydown', (e) => {
      if (!lightbox.open) return;
      if (e.key === 'Escape') closeLightbox();
    });

    viewport.addEventListener('mouseenter', () => paused = true);
    viewport.addEventListener('mouseleave', () => paused = false);
    viewport.addEventListener('focusin', () => paused = true);
    viewport.addEventListener('focusout', () => paused = false);

    async function init() {
      try {
        const res = await fetch('visual.json');
        const data = await res.json();
        items = (data.visuals || []).map(file => ({
          file,
          title: friendlyTitle(file),
          url: `visual/${encodeURI(file)}`
        }));
        buildCarousel();
        renderGallery();
        requestAnimationFrame(tick);
      } catch (err) {
        track.innerHTML = '<p style="padding:1rem">Could not load visuals.json.</p>';
        gridEl.innerHTML = '<p style="padding:1rem">Could not load visuals.json.</p>';
        console.error(err);
      }
    }
    init();
  </script>
</body>

</html>